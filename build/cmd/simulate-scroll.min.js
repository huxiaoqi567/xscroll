define(function(t,o,r){function n(t){n.superclass.constructor.call(this,t)}var e=t("./util"),i=(t("./base"),t("./core")),s=t("./animate"),l=t("./components/scrollbar"),u=t("./components/controller"),c=.382,a=5e-4,f=.03,d=e.prefixStyle("transformOrigin"),h=e.prefixStyle("transform");return e.extend(n,i,{init:function(){var t=this;return n.superclass.init.call(this),t.SROLL_ACCELERATION=t.userConfig.SROLL_ACCELERATION||a,t.BOUNDRY_ACCELERATION=t.userConfig.BOUNDRY_ACCELERATION||f,t._initContainer(),t.resetSize(),t._setOverflowBehavior(),t.defaltConfig={lockY:t.userConfig.lockY,lockX:t.userConfig.lockX},t.boundryCheckEnabled=!0,t},_setOverflowBehavior:function(){var t=this,o=t.renderTo,r=getComputedStyle(o);return t.userConfig.lockX=void 0===t.userConfig.lockX?"hidden"==r["overflow-x"]||t.width==t.containerWidth?!0:!1:t.userConfig.lockX,t.userConfig.lockY=void 0===t.userConfig.lockY?"hidden"==r["overflow-y"]||t.height==t.containerHeight?!0:!1:t.userConfig.lockY,t.userConfig.scrollbarX=void 0===t.userConfig.scrollbarX?t.userConfig.lockX?!1:!0:t.userConfig.scrollbarX,t.userConfig.scrollbarY=void 0===t.userConfig.scrollbarY?t.userConfig.lockY?!1:!0:t.userConfig.scrollbarY,t},_resetLockConfig:function(){var t=this;return t.userConfig.lockX=t.defaltConfig.lockX,t.userConfig.lockY=t.defaltConfig.lockY,t},_initContainer:function(){var t=this;return n.superclass._initContainer.call(t),t.__isContainerInited?void 0:(t.container.style[d]="0 0",t.content.style[d]="0 0",t.translate(0,0),t.__isContainerInited=!0,t)},getScrollTop:function(){var t=window.getComputedStyle(this.container)[h].match(/[-\d\.*\d*]+/g);return t?0===Math.round(t[5])?0:-Math.round(t[5]):0},getScrollLeft:function(){var t=window.getComputedStyle(this.content)[h].match(/[-\d\.*\d*]+/g);return t?0===Math.round(t[4])?0:-Math.round(t[4]):0},scrollLeft:function(t,o,r,n){if(!this.userConfig.lockX){var e=this.userConfig.gpuAcceleration?" translateZ(0) ":"";return this.x=void 0===t||isNaN(t)||0===t?0:-Math.round(t),this._animate("x","translateX("+this.x+"px) scale("+this.scale+")"+e,o,r,n),this}},scrollTop:function(t,o,r,n){if(!this.userConfig.lockY){var e=this.userConfig.gpuAcceleration?" translateZ(0) ":"";return this.y=void 0===t||isNaN(t)||0===t?0:-Math.round(t),this._animate("y","translateY("+this.y+"px) "+e,o,r,n),this}},translate:function(t,o,r){var n=this.userConfig.gpuAcceleration?" translateZ(0) ":"";return this.x=t||this.x||0,this.y=o||this.y||0,this.scale=r||this.scale||1,this.content.style[h]="translate("+this.x+"px,0px) scale("+this.scale+") "+n,this.container.style[h]="translate(0px,"+this.y+"px) "+n,this},_animate:function(t,o,r,n,e){var i=this,r=r||0,n=n||"quadratic",l="y"==t?i.container:i.content,u={css:{transform:o},duration:r,easing:n,run:function(){i.trigger("scroll",{scrollTop:i.getScrollTop(),scrollLeft:i.getScrollLeft(),type:"scroll"})},useTransition:i.userConfig.useTransition,end:function(){e&&e(),0!==i["_bounce"+t]&&void 0!==i["_bounce"+t]||"linear"==n||(i["isScrolling"+t.toUpperCase()]=!1,i.trigger("scrollend",{type:"scrollend",scrollTop:i.getScrollTop(),scrollLeft:i.getScrollLeft(),zoomType:t,duration:r,easing:n}))}},c=i.__timers[t]=i.__timers[t]||new s(l,u);return c.stop(),c.reset(u),c.run(),i.trigger("scrollanimate",{type:"scrollanimate",scrollTop:-i.y,scrollLeft:-i.x,duration:r,easing:n,zoomType:t}),this},_ontap:function(t){var o=this;t.preventDefault(),t.srcEvent.stopPropagation(),o.boundryCheck(),o._triggerClick(t)},_bindEvt:function(){n.superclass._bindEvt.call(this);var t=this;if(!t.__isEvtBind){t.__isEvtBind=!0;var o=new Hammer.Pinch;t.mc.add(o);var r=t.renderTo;return r.addEventListener("touchstart",function(o){t.userConfig.preventDefault&&o.preventDefault(),t.stop()},!1),t.on("tap",t._ontap,t),t.on("panstart",t._onpanstart,t),t.on("pan",t._onpan,t),t.on("panend",t._onpanend,t),window.addEventListener("resize",function(){setTimeout(function(){t.resetSize(),t.boundryCheck(0),t.render()},100)},t),this}},_onpanstart:function(t){var o=this,r=o.getScrollLeft(),n=o.getScrollTop();o.stop(),o.translate(-r,-n);var e=o.mc.get("pan").options.threshold;return o.thresholdY="8"==t.direction?e:"16"==t.direction?-e:0,o.thresholdX="2"==t.direction?e:"4"==t.direction?-e:0,o},_onpan:function(t){var o=this,r=o.boundry,n=o.__topstart||(o.__topstart=-o.getScrollTop()),e=o.__leftstart||(o.__leftstart=-o.getScrollLeft()),i=o.userConfig.lockY?Number(n):Number(n)+(t.deltaY+o.thresholdY),s=o.userConfig.lockX?Number(e):Number(e)+(t.deltaX+o.thresholdX),l=o.containerWidth,u=o.containerHeight;return i=i>r.top?(i-r.top)*c+r.top:i,i=i<r.bottom-u?i+(r.bottom-u-i)*c:i,s=s>r.left?(s-r.left)*c+r.left:s,s=s<r.right-l?s+(r.right-l-s)*c:s,o.translate(s,i),o.directionX="panleft"==t.type?"right":"panright"==t.type?"left":"",o.directionY="panup"==t.type?"down":"pandown"==t.type?"up":"",o.trigger("scroll",{scrollTop:-i,scrollLeft:-s,triggerType:"pan",type:"scroll"}),o},_onpanend:function(t){var o,r=this,n=(r.userConfig,r.computeScroll("x",t.velocityX)),e=r.computeScroll("y",t.velocityY),i=n?n.pos:0,s=e?e.pos:0;return n&&e&&"inside"==n.status&&"inside"==e.status&&n.duration&&e.duration&&(o=Math.max(n.duration,e.duration)),n&&r.scrollLeft(i,o||n.duration,n.easing,function(){r.boundryCheckX()}),e&&r.scrollTop(s,o||e.duration,e.easing,function(){r.boundryCheckY()}),r.directionX=t.velocityX<0?"left":"right",r.directionY=t.velocityY<0?"up":"down",r.__topstart=null,r.__leftstart=null,r},isBoundryOut:function(){return this.isBoundryOutLeft()||this.isBoundryOutRight()||this.isBoundryOutTop()||this.isBoundryOutBottom()},isBoundryOutLeft:function(){return this.getBoundryOutLeft()>0?!0:!1},isBoundryOutRight:function(){return this.getBoundryOutRight()>0?!0:!1},isBoundryOutTop:function(){return this.getBoundryOutTop()>0?!0:!1},isBoundryOutBottom:function(){return this.getBoundryOutBottom()>0?!0:!1},getBoundryOutTop:function(){return this.boundry.top-this.getScrollTop()},getBoundryOutLeft:function(){return this.boundry.left-this.getScrollLeft()},getBoundryOutBottom:function(){return this.boundry.bottom-this.containerHeight+this.getScrollTop()},getBoundryOutRight:function(){return this.boundry.right-this.containerWidth+this.getScrollLeft()},computeScroll:function(t,o){var r=this,n=r.userConfig,e="x"==t?r.getScrollLeft():r.getScrollTop(),i=r.boundry,s="x"==t?i.left:i.top,l="x"==t?i.right:i.bottom,u="x"==t?r.containerWidth:r.containerHeight,c=n.maxSpeed||2,a={},f="inside";if("x"==t&&(r.isBoundryOutLeft()||r.isBoundryOutRight()))return void r.boundryCheckX();if("y"==t&&(r.isBoundryOutTop()||r.isBoundryOutBottom()))return void r.boundryCheckY();if(!("x"==t&&r.userConfig.lockX||"y"==t&&r.userConfig.lockY)){o=o>c?c:-c>o?-c:o;var d=r.SROLL_ACCELERATION*(o/(Math.abs(o)||1)),h=r.BOUNDRY_ACCELERATION,g=isNaN(o/d)?0:o/d,p=Number(e)+g*o/2;if(s>p){var C=s-e,y=(Math.sqrt(-2*d*C+o*o)+o)/d,_=o-d*y,v=Math.abs(_/h),b=_/2*v;g=y+v,p=s+b,f="outside"}else if(p>u-l){var C=l-u+e,y=(Math.sqrt(-2*d*C+o*o)-o)/d,_=o-d*y,v=Math.abs(_/h),b=_/2*v;g=y+v,p=u-l+b,f="outside"}return a.pos=p,a.duration=g,a.easing=Math.abs(o)>2?"circular":"quadratic",a.status=f,r["isScrolling"+t.toUpperCase()]=!0,a}},boundryCheckX:function(t,o,r){var n=this;if("function"==typeof arguments[0]?(r=arguments[0],t=n.userConfig.BOUNDRY_CHECK_DURATION,o=n.userConfig.BOUNDRY_CHECK_EASING):(t=0===t?0:n.userConfig.BOUNDRY_CHECK_DURATION,o=o||n.userConfig.BOUNDRY_CHECK_EASING),n.boundryCheckEnabled&&!n.userConfig.lockX){var e=n.getScrollLeft(),i=n.containerWidth,s=n.boundry;return e<s.left?n.scrollLeft(-s.left,t,o,r):e>i-s.right&&n.scrollLeft(i-s.right,t,o,r),n}},boundryCheckY:function(t,o,r){var n=this;if("function"==typeof arguments[0]?(r=arguments[0],t=n.userConfig.BOUNDRY_CHECK_DURATION,o=n.userConfig.BOUNDRY_CHECK_EASING):(t=0===t?0:n.userConfig.BOUNDRY_CHECK_DURATION,o=o||n.userConfig.BOUNDRY_CHECK_EASING),n.boundryCheckEnabled&&!n.userConfig.lockY){var e=n.getScrollTop(),i=n.containerHeight,s=n.boundry;return e<s.top?n.scrollTop(-s.top,t,o,r):e>i-s.bottom&&n.scrollTop(i-s.bottom,t,o,r),n}},boundryCheck:function(t,o,r){return this.boundryCheckX(t,o,r),this.boundryCheckY(t,o,r),this},stop:function(){var t=this;if(t.__timers.x&&t.__timers.x.stop(),t.__timers.y&&t.__timers.y.stop(),t.isScrollingX||t.isScrollingY){var o=t.getScrollTop(),r=t.getScrollLeft();t.trigger("scrollend",{scrollTop:o,scrollLeft:r}),t.trigger("stop",{scrollTop:o,scrollLeft:r}),t.isScrollingX=!1,t.isScrollingY=!1,t._isClickDisabled=!0}else t._isClickDisabled=!1;return t},render:function(){var t=this;return n.superclass.render.call(this),"static"==getComputedStyle(t.renderTo).position&&(t.renderTo.style.position="relative"),t.renderTo.style.overflow="hidden",t.initScrollBars(),t.initController(),t.initTouchAction(),t},initTouchAction:function(){var t=this,o="none";return!t.userConfig.lockX&&t.userConfig.lockY?o="pan-y":!t.userConfig.lockY&&t.userConfig.lockX?o="pan-x":t.userConfig.lockX&&t.userConfig.lockY&&(o="auto"),t.mc.set({touchAction:o}),t},initScrollBars:function(){var t=this;return t.userConfig.scrollbarX&&(t.scrollbarX=t.scrollbarX||new l({xscroll:t,type:"x"}),t.scrollbarX._update(),t.scrollbarX.hide()),t.userConfig.scrollbarY&&(t.scrollbarY=t.scrollbarY||new l({xscroll:t,type:"y"}),t.scrollbarY._update(),t.scrollbarY.hide()),t},initController:function(){var t=this;return t.controller=t.controller||new u({xscroll:t}),t}}),"object"==typeof r&&r.exports?void(r.exports=n):n});
define(function(n,e,t){var l,r=n("../util"),i=n("../base"),o="Loading...",s="Pull Up To Refresh",u="Release To Refresh",a=60,c=40,d=function(n){d.superclass.constructor.call(this),this.userConfig=r.mix({upContent:s,downContent:u,pullUpHeight:a,height:c,loadingContent:o,bufferHeight:0,clsPrefix:"xs-plugin-pullup-"},n)};if(r.extend(d,i,{pluginId:"pullup",pluginInitializer:function(n){var e=this;return e.xscroll=n.render(),l=e.userConfig.clsPrefix,e.render(),e},pluginDestructor:function(){var n=this;n.pullup&&n.pullup.remove(),n.xscroll.off("scrollend",n._scrollEndHandler,n),n.xscroll.off("scroll",n._scrollHandler,n),n.xscroll.off("pan",n._panHandler,n),n.xscroll.boundry.resetBottom(),n.__isRender=!1,n._evtBinded=!1,delete n},render:function(){var n=this;if(!n.__isRender){n.__isRender=!0;var e=l+"container",t=n.userConfig.height,i=n.pullup=document.createElement("div");return i.className=e,i.style.position="absolute",i.style.width="100%",i.style.height=t+"px",i.style.bottom=-t+"px",n.xscroll.container.appendChild(i),n.xscroll.boundry.expandBottom(n.userConfig.height),r.addClass(i,l+n.status),i.innerHTML=n.userConfig[n.status+"Content"]||n.userConfig.content,n._bindEvt(),n}},_bindEvt:function(){var n=this;if(!n._evtBinded){n._evtBinded=!0;var e=(n.pullup,n.xscroll);return e.on("pan",n._panHandler,n),n.userConfig.bufferHeight>0&&e.on("scroll",n._scrollHandler,n),e.on("scrollend",n._scrollEndHandler,n),n}},_scrollEndHandler:function(n){var e=this,t=e.xscroll;return n.scrollTop==t.containerHeight-t.height+e.userConfig.height&&e._changeStatus("loading"),e},_scrollHandler:function(n){var e=this,t=e.xscroll;return!e.isLoading&&Math.abs(n.scrollTop)+t.height+e.userConfig.height+e.userConfig.bufferHeight>=t.containerHeight+t.boundry._xtop+t.boundry._xbottom&&e._changeStatus("loading"),e},_panHandler:function(){var n=this,e=n.xscroll,t=-e.getScrollTop();return n._changeStatus(t<e.height-e.containerHeight-n.userConfig.pullUpHeight?"down":"up"),n},_changeStatus:function(n){if("loading"==n||!this.isLoading){var e=this.status;return this.status=n,r.removeClass(this.pullup,l+e),r.addClass(this.pullup,l+n),this.pullup.innerHTML=this.userConfig[n+"Content"],e!=n&&(this.trigger("statuschange",{prevVal:e,newVal:n}),"loading"==n&&(this.isLoading=!0,this.trigger("loading"))),this}},complete:function(){{var n=this;n.xscroll}return n.isLoading=!1,n._changeStatus("up"),n}}),"object"==typeof t&&t.exports)t.exports=d;else if(window.XScroll&&window.XScroll.Plugins)return XScroll.Plugins.PullUp=d});